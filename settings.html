<!DOCTYPE HTML>
<html>
	<head>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	</head>
	<body>
		<h1>Habitica-Tasks Options v1.10</h1>
		<p>User authentication</p>
		<label for="UserID">User ID:
			<input id="UserID">
		</label>
		<label for="APIToken">API Token:
			<input id="APIToken">
		</label>
    <br><br>
		<button type="submit" data-theme="a" id="b-submit">Submit</button>
	</body>
	
	<script>
		function saveOptions() {
			var userId = document.getElementById("UserID");
			var apiToken = document.getElementById("APIToken");
 
    			var options = {
				'userId': userId.value,
				'apiToken': apiToken.value
			}
			return options;
		};
		
		var submitButton = document.getElementById("b-submit");
  		submitButton.addEventListener("click",
    			function() {	
	      			var options = saveOptions();
	      			location.href = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
	      			<!--//document.location = location;-->
	    			},
  			false);
			
		function updateSettings() {
			if (window.location.search) {
				var settings = decodeURIComponent(window.location.search).replace('?settings=','');
				if (settings == "null") {
					settings = '{"banner":"Hello World","weekday":"y","showdate":true,"footer":"03"}';
				}
				if (settings) {
					var json = $.parseJSON(settings);
					if (json.banner) {
						$('#banner').val(json.banner);
					}
					if (json.weekday) {
						$('#weekday').val(json.weekday).slider('refresh');
					}
					if (json.footer) {
						$('#footer').val(json.footer).selectmenu('refresh');
					}
					$("#showdate").prop('checked',json.showdate).checkboxradio('refresh');
	      			}
	    		}
	  	}

		$('#main').bind('pageinit', updateSettings);
			
	</script>
</html>
